<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rusunami The Jarrdin Cihampelas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5
        }

        /* Sidebar styling */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100vh;
            background-color: #323131 !important; /* Paksa jadi hitam */
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
            color: white;
        }
        

        /* Sidebar hidden */
        .sidebar.hide {
            transform: translateX(-100%);
        }

        /* Toggle button sekarang ada di dalam sidebar, pojok kanan atas */
        .toggle-btn {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: #ffc107;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 20px;
            z-index: 1100; /* Pastikan di atas elemen lain */
            border-radius: 4px;
        }


        /* Email user login, diberi margin-top 75px (¬± 2 cm dari tombol toggle) */
        #user-info {
            font-weight: bold;
            margin-top: 75px;
            margin-bottom: 20px;
            color: #ffffff;
            font-size: 14px;
        }

        /* Tombol menu */
        .menu-item {
            display: block;
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid transparent;
            background-color: #000000;
            color: white;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
            text-align: left;
            transition: border-color 0.3s ease;
        }

        .menu-item:hover {
            border-color: #ffa500;
            background-color: #000;
        }

        .menu-item.active {
            background-color: #005a09; 
            font-weight: bold;
            color: white;
        }

        /* Tombol logout */
        .btn-danger {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 16px;
        }

        /* Konten utama */
        .main-content {
            margin-left: 300px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .sidebar.hide ~ .main-content {
            margin-left: 60px; /* agar tidak mentok ke kiri saat sidebar sembunyi */
        }


        /* Saat sidebar di-hide, hanya tombol toggle yang terlihat */
        .sidebar.hide > *:not(.toggle-btn) {
            display: none;
        }

        /* Tambahan (opsional): toggle tetap muncul di kiri atas halaman meskipun sidebar tersembunyi */
        .sidebar.hide .toggle-btn {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1100;
        }

        /* Saat sidebar tampil, tombol toggle di dalam sidebar */
        .sidebar .toggle-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }

        /* Saat sidebar disembunyikan, pindahkan tombol toggle ke kiri atas halaman */
        .sidebar.hide .toggle-btn {
            position: fixed;
            top: 10px;
            left: 310px;
            z-index: 1100; 
        }




        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 30px;
            border-bottom: 3px solid #000000; 
            padding-bottom: 20px;
            text-align: center;
        }
        .logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }
        .title {
            margin: 0;
            color: #008000;
            text-shadow: 0.5px 0.5px 0px white;
            /* border-bottom: 3px solid #006400; Garis tebal di bawah judul */
            /* padding-bottom: 20px; */
        }
        .sidebar {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .table th, .table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .table th {
            background-color: #f2f2f2;
        }
        .expander {
            border: 1px solid #ddd;
            margin: 10px 0;
            border-radius: 5px;
        }
        .expander-header {
            background-color: #f8f9fa;
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
        }
        .expander-content {
            padding: 15px;
            display: none;
        }
        .expander-content.active {
            display: block;
        }
        .checkbox-group {
            margin: 10px 0;
        }
        .checkbox-group label {
            font-weight: normal;
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }
        .hidden {
            display: none;
        }
        .menu-item {
            display: block;
            width: 100%;
            text-align: left;
            margin-bottom: 5px;
        }
        

        .two-column {
            display: flex;
            gap: 20px;
        }
        .two-column > div:first-child {
            flex: 3.6;
        }
        .two-column > div:last-child {
            flex: 1;
        }


        /* table */
        #rentals-table table {
            width: 100%; /* Memastikan tabel mengikuti lebar container */
            border-collapse: collapse;
            font-size: 0.9rem; /* Font sedikit lebih kecil untuk compact */
        }

        #rentals-table th, #rentals-table td {
            padding: 6px 8px; /* Padding kecil untuk compact */
            border: 1px solid #ddd;
            white-space: nowrap; /* Membuat teks tidak membungkus baris, agar rapi */
            text-align: left;
            max-width: 150px; /* Membatasi maksimal lebar kolom */
            overflow: hidden;
            text-overflow: ellipsis; /* Jika teks terlalu panjang, tampilkan ... */
        }

        #rentals-table thead {
            background-color: #f8f9fa;
        }

        #rentals-table tbody tr:hover {
            background-color: #f1f1f1;
        }

        /* Container untuk scroll horizontal jika tabel tetap terlalu lebar */
        #rentals-table {
            overflow-x: auto;
        }

        /* judul menu */
        .menu-title {
            margin-top: 20px;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            padding-left: 20px;
        }

        .menu-box {
            background-color: #000; /* Hitam */
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
            padding-right: 20px;
        }



    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="data:image/png;base64,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" class="logo" alt="Logo" id="logo-img"/>
            <h1 class="title">Rusunami The Jarrdin Cihampelas</h1>
        </div>

        

        <div id="auth-section">
            <!-- Login Page -->
            <div id="login-page">
                <h2>üîê Login Agen</h2>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password">
                </div>
                <button onclick="login()">Login</button>
                <p>Belum punya akun? <a href="#" onclick="showSignup()">Daftar di sini</a></p>
            </div>

            <!-- Signup Page -->
            <div id="signup-page" class="hidden">
                <h2>üìù Daftar Agen Baru</h2>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="signup-email">
                </div>
                <div class="form-group">
                    <label for="nib">NIB</label>
                    <input type="text" id="nib" name="nib" required minlength="13" maxlength="13" pattern="\d{13}">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="signup-password">
                </div>

                <button onclick="signup()">Daftar</button>
                <p>Sudah punya akun? <a href="#" onclick="showLogin()">Login di sini</a></p>
            </div>
        </div>


        <div id="main-section" class="hidden">
            <button id="toggle-sidebar" class="toggle-btn">‚ò∞</button> <!-- Pindah ke dalam sidebar -->
                
            

            <div class="sidebar" id="sidebar">
                <div id="user-info">Login sebagai: <span id="user-email">example@email.com</span></div>

                <div class="menu-box">
                    <h3 class="menu-title">MENU</h3>

                    <button class="menu-item active" id="menu-input" onclick="showInputForm()">üìã Input Data Penyewa</button>
                    <button class="menu-item" id="menu-view" onclick="showViewData()">üìä Lihat/Edit Data Penyewa</button>
                </div>

                <!-- <div id="user-info">Login sebagai: <span id="user-email">example@email.com</span></div>
                <h3 class="menu-title">MENU</h3>

                <button class="menu-item active" id="menu-input" onclick="showInputForm()">üìã Input Data Penyewa</button>
                <button class="menu-item" id="menu-view" onclick="showViewData()">üìä Lihat/Edit Data Penyewa</button> -->
                <button class="btn-danger" onclick="logout()">Logout</button>
            </div>





            <div id="input-form-section">
                <h2>üìã Form Input Data Penyewa</h2>
                <br>
                <div class="form-group">
                    <label>Nama Penyewa</label>
                    <input type="text" id="nama">
                </div>
                <div class="form-group">
                    <label>Tower</label>
                    <select id="tower">
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Lantai</label>
                    <input type="text" id="lantai">
                </div>
                <div class="form-group">
                    <label>Nomor Unit</label>
                    <input type="text" id="unit">
                </div>
                <div class="form-group">
                    <label>Kewarganegaraan</label>
                    <select id="status_kewarganegaraan">
                        <option value="WNI">WNI</option>
                        <option value="WNA">WNA</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Metode Pembayaran</label>
                    <select id="metode_pembayaran" onchange="toggleMetodeLain()">
                        <option value="Cash">Cash</option>
                        <option value="Kartu Kredit">Kartu Kredit</option>
                        <option value="Kartu Debit">Kartu Debit</option>
                        <option value="QRIS">QRIS</option>
                        <option value="Others">Others</option>
                    </select>
                </div>
                <div class="form-group hidden" id="metode-lain-group">
                    <label>Metode Lainnya</label>
                    <input type="text" id="metode_lain">
                </div>
                <div class="form-group">
                    <label>Tanggal Check-In</label>
                    <input type="date" id="tanggal_checkin">
                </div>
                <div class="form-group">
                    <label>Waktu Check-In</label>
                    <input type="time" id="waktu_checkin">
                </div>
                <div class="form-group">
                    <label>Tanggal Check-Out</label>
                    <input type="date" id="tanggal_checkout">
                </div>
                <div id="lama-menginap-info"></div>
                <button class="btn-success" onclick="saveRental()">Simpan Data Penyewa</button>
            </div>

            
            <div id="view-data-section" class="hidden">
                <h2>Data Penyewa</h2>
                <div class="two-column">
                    <div>
                        <button class="btn-success" onclick="downloadCSV()">üì• Download CSV</button>
                    </div>
                    <div>
                        <button class="btn-success" onclick="downloadAllLogsCSV()">üì• Download Riwayat Perubahan</button>
                    </div>
                    <div>
                        <button onclick="refreshTable()">üîÑ Refresh Tabel</button>
                    </div>
                </div>
                <div id="rentals-table"></div>
                <br>
                <hr>
                <h3>Input Waktu Check-out dan Komentar</h3>
                <div id="rentals-expanders"></div>
            </div>


            <!-- Pop Up Log History -->
            <div id="historyModal" style="display:none; position:fixed; top:10%; left:10%; background:white; border:1px solid black; padding:20px; z-index:9999; width:80%; max-height:80%; overflow-y:auto;">
                <h3>Riwayat Perubahan</h3>
                <div id="historyContent"></div>
                <button onclick="downloadHistoryCSV()">Download CSV</button>
                <button onclick="document.getElementById('historyModal').style.display='none'">Tutup</button>
            </div>

        </div>

        <div id="alert-container"></div>
    </div>

    <script>
        let currentUser = null;
        let pelanggaranList = [];
        let rentalsData = [];

        // sidebar
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggle-sidebar');

        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('hide');
        });

        // Set email user
        const currentUserEmail = sessionStorage.getItem('userEmail') || 'belum login';
        document.getElementById('user-email').innerText = currentUserEmail;


        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            initializeCurrentDateTime();
            loadPelanggaranList();
        });

        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/user');
                const data = await response.json();
                if (data.user) {
                    currentUser = data.user;
                    showMainSection();
                } else {
                    showAuthSection();
                }
            } catch (error) {
                showAlert('Error checking auth status', 'danger');
            }
        }

        function initializeCurrentDateTime() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const currentTime = now.toTimeString().slice(0, 5);
            
            document.getElementById('tanggal_checkin').value = today;
            document.getElementById('waktu_checkin').value = currentTime;
            document.getElementById('tanggal_checkout').value = today;
            
            calculateLamaMenginap();
        }

        async function loadPelanggaranList() {
            try {
                const response = await fetch('/api/pelanggaran-list');
                const data = await response.json();
                pelanggaranList = data.data;
            } catch (error) {
                console.error('Error loading pelanggaran list:', error);
            }
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                if (data.success) {
                    currentUser = email;
                    showMainSection();
                } else {
                    showAlert(data.message, 'danger');
                }
            } catch (error) {
                showAlert('Error during login', 'danger');
            }
        }

        async function signup() {
        const email = document.getElementById('signup-email').value.trim();
        const password = document.getElementById('signup-password').value;
        const nib = document.getElementById('nib').value.trim();

        // Validasi frontend sederhana NIB sebelum submit
        if (!/^\d{13}$/.test(nib)) {
            showAlert('NIB tidak valid.', 'danger');
            return;
        }
        if (password.length < 8) {
            showAlert('Password harus minimal 8 karakter.', 'danger');
            return;
        }
        if (!email) {
            showAlert('Email harus diisi.', 'danger');
            return;
        }

        try {
            const response = await fetch('/api/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password, nib }) // sekarang sudah ada nib
            });

            const data = await response.json();
            if (data.success) {
                showAlert(data.message, 'success');
                showLogin();
            } else {
                showAlert(data.message, 'danger');
            }
        } catch (error) {
            showAlert('Error during signup', 'danger');
        }
    }



        async function logout() {
            try {
                await fetch('/api/logout', { method: 'POST' });
                currentUser = null;
                showAuthSection();
            } catch (error) {
                showAlert('Error during logout', 'danger');
            }
        }

        function showLogin() {
            document.getElementById('login-page').classList.remove('hidden');
            document.getElementById('signup-page').classList.add('hidden');
        }

        function showSignup() {
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('signup-page').classList.remove('hidden');
        }

        function showAuthSection() {
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('main-section').classList.add('hidden');
        }

        function showMainSection() {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('main-section').classList.remove('hidden');
            document.getElementById('user-info').innerHTML = `üë§ <strong>${currentUser}</strong>`;
            showInputForm();
        }

        function showInputForm() {
            document.getElementById('input-form-section').classList.remove('hidden');
            document.getElementById('view-data-section').classList.add('hidden');
            document.getElementById('menu-input').classList.add('active');
            document.getElementById('menu-view').classList.remove('active');
        }

        function showViewData() {
            document.getElementById('input-form-section').classList.add('hidden');
            document.getElementById('view-data-section').classList.remove('hidden');
            document.getElementById('menu-input').classList.remove('active');
            document.getElementById('menu-view').classList.add('active');
            loadRentalsData();
        }

        function toggleMetodeLain() {
            const metode = document.getElementById('metode_pembayaran').value;
            const metodeLainGroup = document.getElementById('metode-lain-group');
            if (metode === 'Others') {
                metodeLainGroup.classList.remove('hidden');
            } else {
                metodeLainGroup.classList.add('hidden');
            }
        }

        function calculateLamaMenginap() {
            const checkin = document.getElementById('tanggal_checkin').value;
            const checkout = document.getElementById('tanggal_checkout').value;
            
            if (checkin && checkout) {
                const checkinDate = new Date(checkin);
                const checkoutDate = new Date(checkout);
                const diffTime = checkoutDate - checkinDate;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const infoDiv = document.getElementById('lama-menginap-info');
                if (diffDays < 0) {
                    infoDiv.innerHTML = '<div class="alert alert-danger">Tanggal Check-Out tidak boleh lebih awal dari Tanggal Check-In</div>';
                } else {
                    infoDiv.innerHTML = `<div class="alert alert-info">üïí Lama Menginap: <strong>${diffDays} hari</strong></div>`;
                }
                return diffDays;
            }
            return 0;
        }

        // Add event listeners for date calculation
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('tanggal_checkin').addEventListener('change', calculateLamaMenginap);
            document.getElementById('tanggal_checkout').addEventListener('change', calculateLamaMenginap);
        });

        async function saveRental() {
            const lamaMenginap = calculateLamaMenginap();
            if (lamaMenginap < 0) {
                showAlert('Tanggal Check-Out tidak boleh lebih awal dari Tanggal Check-In', 'danger');
                return;
            }

            const data = {
                nama: document.getElementById('nama').value,
                tower: document.getElementById('tower').value,
                lantai: document.getElementById('lantai').value,
                unit: document.getElementById('unit').value,
                status_kewarganegaraan: document.getElementById('status_kewarganegaraan').value,
                metode_pembayaran: document.getElementById('metode_pembayaran').value,
                metode_lain: document.getElementById('metode_lain').value,
                tanggal_checkin: document.getElementById('tanggal_checkin').value,
                waktu_checkin: document.getElementById('waktu_checkin').value,
                tanggal_checkout: document.getElementById('tanggal_checkout').value,
                lama_menginap: lamaMenginap
            };

            try {
                const response = await fetch('/api/rental', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    showAlert(result.message, 'success');
                    // Reset form
                    document.getElementById('nama').value = '';
                    document.getElementById('lantai').value = '';
                    document.getElementById('unit').value = '';
                    document.getElementById('metode_lain').value = '';
                    initializeCurrentDateTime();
                } else {
                    showAlert(result.message, 'danger');
                }
            } catch (error) {
                showAlert('Error saving rental data', 'danger');
            }
        }

        async function loadRentalsData() {
            try {
                const response = await fetch('/api/rentals');
                const result = await response.json();
                if (result.success) {
                    rentalsData = result.data;
                    displayRentalsTable();
                    displayRentalsExpanders();
                }
            } catch (error) {
                showAlert('Error loading rentals data', 'danger');
            }
        }

        function displayRentalsTable() {
            const tableContainer = document.getElementById('rentals-table');
            
            if (rentalsData.length === 0) {
                tableContainer.innerHTML = '<div class="alert alert-info">Belum ada data.</div>';
                return;
            }

            let tableHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nama Penyewa</th>
                            <th>Status Kewarganegaraan</th>
                            <th>Tower</th>
                            <th>Lantai</th>
                            <th>Unit</th>
                            <th>Metode Pembayaran</th>
                            <th>Tanggal Check-In</th>
                            <th>Waktu Check-In</th>
                            <th>Tanggal Check-Out</th>
                            <th>Waktu Check-Out</th>
                            <th>Lama Menginap (hari)</th>
                            <th>Komentar</th>
                            <th>Agen</th>
                            <th>Diedit Oleh</th>
                            <th>Log History</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

        
            



            rentalsData.forEach(rental => {
                const komentarStr = Array.isArray(rental.komentar) ? rental.komentar.join(', ') : '';
                tableHTML += `
                    <tr>
                        <td>${rental.nama || ''}</td>
                        <td>${rental.status_kewarganegaraan || ''}</td>
                        <td>${rental.tower || ''}</td>
                        <td>${rental.lantai || ''}</td>
                        <td>${rental.unit || ''}</td>
                        <td>${rental.metode_pembayaran || ''}</td>
                        <td>${rental.tanggal_checkin || ''}</td>
                        <td>${rental.waktu_checkin || ''}</td>
                        <td>${rental.tanggal_checkout || ''}</td>
                        <td>${rental.waktu_checkout || ''}</td>
                        <td>${rental.lama_menginap || ''}</td>
                        <td>${komentarStr}</td>
                        <td>${rental.email_agent || ''}</td>
                        <td>${rental.diedit_oleh || ''}</td>
                        <td>
                            <button onclick="showHistory(${rental.id})">Show History</button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            tableContainer.innerHTML = tableHTML;
        }

        function displayRentalsExpanders() {
            const expandersContainer = document.getElementById('rentals-expanders');
            let expandersHTML = '';

            rentalsData.forEach((rental, index) => {
                expandersHTML += `
                    <div class="expander">
                        <div class="expander-header" onclick="toggleExpander(${index})">
                            Penyewa ke-${index + 1}: ${rental.nama} (diinput oleh ${rental.email_agent})
                        </div>
                        <div class="expander-content" id="expander-${index}">
                            <div class="form-group">
                                <label>Isi Waktu Check-out</label>
                                <input type="time" id="waktu-checkout-${index}" value="${rental.waktu_checkout || ''}">
                            </div>
                            <button onclick="saveCheckoutTime(${rental.id}, ${index})" class="btn-success">Simpan Waktu Check-out</button>
                            
                            <h4>Komentar</h4>
                            <div class="checkbox-group" id="komentar-${index}">
                                ${pelanggaranList.map(pelanggaran => `
                                    <label>
                                        <input type="checkbox" value="${pelanggaran}" 
                                               ${(rental.komentar || []).includes(pelanggaran) ? 'checked' : ''}>
                                        ${pelanggaran}
                                    </label>
                                `).join('')}
                            </div>
                            <button onclick="saveKomentar(${rental.id}, ${index})" class="btn-success">Simpan Komentar</button>
                        </div>
                    </div>
                `;
            });

            expandersContainer.innerHTML = expandersHTML;
        }

        function toggleExpander(index) {
            const content = document.getElementById(`expander-${index}`);
            content.classList.toggle('active');
        }

        async function saveCheckoutTime(rentalId, index) {
            const waktuCheckout = document.getElementById(`waktu-checkout-${index}`).value;

            try {
                const response = await fetch('/api/update-checkout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rentalId, waktuCheckout })
                });

                const result = await response.json();
                if (result.success) {
                    showAlert(result.message, 'success');
                    loadRentalsData(); // Refresh data
                } else {
                    showAlert(result.message, 'danger');
                }
            } catch (error) {
                showAlert('Error saving checkout time', 'danger');
            }
        }

        async function saveKomentar(rentalId, index) {
            const checkboxes = document.querySelectorAll(`#komentar-${index} input[type="checkbox"]:checked`);
            const selectedKomentar = Array.from(checkboxes).map(cb => cb.value);

            try {
                const response = await fetch('/api/update-komentar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rentalId, komentar: selectedKomentar })
                });

                const result = await response.json();
                if (result.success) {
                    showAlert(result.message, 'success');
                    loadRentalsData(); // Refresh data
                } else {
                    showAlert(result.message, 'danger');
                }
            } catch (error) {
                showAlert('Error saving komentar', 'danger');
            }
        }

        async function downloadCSV() {
            try {
                const response = await fetch('/api/download-csv');
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = 'data_penyewa.csv';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                } else {
                    showAlert('Error downloading CSV', 'danger');
                }
            } catch (error) {
                showAlert('Error downloading CSV', 'danger');
            }
        }

        function refreshTable() {
            loadRentalsData();
            showAlert('Tabel berhasil di-refresh', 'success');
        }



        let lastHistoryLogs = []; // disimpan global agar bisa diakses saat export

        async function showHistory(rentalId) {
            try {
                const response = await fetch(`/api/logs/${rentalId}`);
                const result = await response.json();

                if (result.success && result.logs.length > 0) {
                    lastHistoryLogs = result.logs; // simpan agar bisa export

                    let htmlContent = `<p><strong>üÜî Penyewa ID:</strong> ${rentalId}</p><hr>`;
                    const formatTime = val => {
                        if (!val || typeof val !== 'string') return '-';
                        const match = val.match(/^(\d{2}:\d{2})/);
                        return match ? match[1] : val;
                    };

                    result.logs.forEach(log => {
                        const date = new Date(log.time_stamp);
                        const timestamp = new Date(log.time_stamp).toLocaleString('id-ID', {
                            timeZone: 'Asia/Jakarta',
                            hour12: false
                        }).replace(',', '');

                        const oldVal = formatTime(log.old_value);
                        const newVal = formatTime(log.new_value);

                        htmlContent += `
                            <div style="margin-bottom: 15px;">
                                <p><strong>üìÖ ${timestamp}</strong></p>
                                <p>üë§ ${log.email} - <strong>${log.action.toUpperCase()}</strong></p>
                                <p>üìù Kolom: ${log.field_changed}</p>
                                <p>üîé ${oldVal} ‚Üí ${newVal}</p>
                                <hr>
                            </div>
                        `;
                    });

                    document.getElementById('historyContent').innerHTML = htmlContent;
                    document.getElementById('historyModal').style.display = 'block';
                } else {
                    document.getElementById('historyContent').innerHTML = `<p>Tidak ada riwayat perubahan.</p>`;
                    document.getElementById('historyModal').style.display = 'block';
                }
            } catch (error) {
                console.error('Gagal memuat riwayat log:', error);
                alert('Gagal memuat log.');
            }
        }

        function downloadHistoryCSV() {
            if (!lastHistoryLogs || lastHistoryLogs.length === 0) {
                alert("Belum ada log untuk diunduh.");
                return;
            }

            const headers = ["Waktu", "Email", "Aksi", "Kolom", "Old Value", "New Value"];
            let csv = headers.join(",") + "\n";

            const formatTime = val => {
                if (!val || typeof val !== 'string') return '-';
                const match = val.match(/^(\d{2}:\d{2})/);
                return match ? match[1] : val;
            };

            lastHistoryLogs.forEach(log => {
                const date = new Date(log.time_stamp).toISOString().replace('T', ' ').substring(0, 19);
                const row = [
                    date,
                    log.email,
                    log.action,
                    log.field_changed,
                    formatTime(log.old_value),
                    formatTime(log.new_value)
                ].map(v => `"${v || ""}"`).join(",");
                csv += row + "\n";
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "log_riwayat_penyewa.csv";
            a.style.display = "none";

            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }


        async function downloadAllLogsCSV() {
            try {
                const response = await fetch('/api/all-logs');
                const result = await response.json();

                if (result.success && result.logs.length > 0) {
                    const headers = ["Rental ID", "Waktu", "Email", "Aksi", "Kolom", "Old Value", "New Value"];
                    let csv = headers.join(",") + "\n";

                    const formatTime = val => {
                        if (!val || typeof val !== 'string') return '-';
                        const match = val.match(/^(\d{2}:\d{2})/);
                        return match ? match[1] : val;
                    };

                    result.logs.forEach(log => {
                        const timestamp = new Date(log.time_stamp).toISOString().replace('T', ' ').substring(0, 19);
                        const row = [
                            log.rental_id,
                            timestamp,
                            log.email,
                            log.action,
                            log.field_changed,
                            formatTime(log.old_value),
                            formatTime(log.new_value)
                        ].map(v => `"${v || ""}"`).join(",");
                        csv += row + "\n";
                    });

                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "semua_log_riwayat.csv";
                    a.style.display = "none";

                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } else {
                    alert("Tidak ada log riwayat ditemukan.");
                }
            } catch (error) {
                console.error("Gagal mengunduh semua log riwayat:", error);
                alert("Gagal mengunduh log.");
            }
        }




        function showAlert(message, type) {
            const alertContainer = document.getElementById('alert-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertContainer.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>